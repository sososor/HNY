<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025年 新年の抱負と習慣</title>
    <style>
        body {
            font-family: 'Helvetica Neue', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            text-align: center;
            color: #003366;
            margin-bottom: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        textarea {
            width: 100%;
            height: 60px;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            background-color: #f7f9fc;
        }
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #005b96;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #004080;
        }
        ul {
            list-style-type: none;
            padding-left: 0;
        }
        li {
            background-color: #e6f0ff;
            border-left: 4px solid #005b96;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .controls {
            display: flex;
            gap: 5px;
        }
        .controls button {
            background-color: #005b96;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .logout-btn {
            background-color: #ff4d4d;
            margin-top: 30px;
        }
        .logout-btn:hover {
            background-color: #e60000;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>2025年 新年の抱負と習慣</h1>
    <h2>習慣</h2>
    <textarea id="habitInput" placeholder="習慣を入力してください..."></textarea>
    <button onclick="addItem('habit')">保存</button>
    <ul id="habits-list"></ul>

    <h2>メインの抱負</h2>
    <textarea id="mainGoalInput" placeholder="メインの抱負を入力してください..."></textarea>
    <button onclick="addItem('main')">保存</button>
    <ul id="main-goals-list"></ul>

    <h2>サブの抱負</h2>
    <textarea id="subGoalInput" placeholder="サブの抱負を入力してください..."></textarea>
    <button onclick="addItem('sub')">保存</button>
    <ul id="sub-goals-list"></ul>

    <button class="logout-btn" onclick="logout()">ログアウト</button>
</div>

<script>
    let habitCount = 1;
    let mainGoalCount = 1;
    let subGoalCount = 1;

    const apiUrl = 'http://localhost:8080';  // GoサーバーのURL
    let authToken = localStorage.getItem('authToken');
    
    if (!authToken) {
        alert("ログインが必要です！");
        window.location.href = "login.html";  // ログインページにリダイレクト
    }

    // タスクを表示
    async function fetchTasks() {
        try {
            const response = await fetch(`${apiUrl}/tasks`, {
                headers: { 'Authorization': `Bearer ${authToken}` },
            });
            const tasks = await response.json();
            tasks.forEach(task => {
                addTaskToList(task);
            });
        } catch (error) {
            console.error('タスクの取得エラー:', error);
        }
    }

    // タスクをリストに追加
    function addTaskToList(task) {
        let ul;
        if (task.type === "habit") {
            ul = document.getElementById("habits-list");
        } else if (task.type === "main") {
            ul = document.getElementById("main-goals-list");
        } else {
            ul = document.getElementById("sub-goals-list");
        }

        let li = document.createElement("li");
        li.innerHTML = `
            ${task.content}
            <div class="controls">
                <button onclick="deleteTask(${task.id})">削除</button>
            </div>
        `;
        ul.appendChild(li);
    }

    // アイテムの追加
    async function addItem(type) {
        const input = document.getElementById(`${type}Input`);
        const content = input.value.trim();

        if (content === "") {
            alert(`${type}は空白にできません`);
            return;
        }

        const task = { content, type };
        try {
            const response = await fetch(`${apiUrl}/tasks`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                },
                body: JSON.stringify(task),
            });

            const newTask = await response.json();
            addTaskToList(newTask);
            input.value = "";  // 入力フィールドをリセット
        } catch (error) {
            console.error("タスクの追加エラー:", error);
        }
    }

    // タスクの削除
    async function deleteTask(id) {
        try {
            const response = await fetch(`${apiUrl}/tasks/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                },
            });

            if (response.ok) {
                alert('タスクが削除されました');
                fetchTasks();  // タスクリストを再取得
            } else {
                alert('タスク削除のエラー');
            }
        } catch (error) {
            console.error('タスク削除エラー:', error);
        }
    }

    // ログアウト機能
    function logout() {
        localStorage.removeItem('authToken');
        window.location.href = "Log.html";  // ログインページにリダイレクト
    }
</script>

</body>
</html>
